default_platform(:ios)

platform :ios do
  desc "批量创建 App ID（Bundle ID）"
  lane :create_bundle_ids do
    require 'csv'

    # 读取 CSV 并批量创建 Bundle ID
    prefix = "com.getsticker.stickerpack"

    CSV.foreach(File.expand_path("../apps_config/apps.csv", __dir__), headers: true) do |row|
      short_id = row["short_id"]
      app_name = row["app_name"]
      bundle_id = "#{prefix}.#{short_id}"

      UI.message("📱 正在创建 App ID: #{bundle_id} (#{app_name})")

      begin
        create_app_identifier(
          bundle_id: bundle_id,
          app_name: app_name
        )
        UI.success("✅ 成功创建 #{bundle_id}")
      rescue => e
        UI.error("❌ 创建失败 #{bundle_id} - #{e.message}")
      end
    end
  end
end